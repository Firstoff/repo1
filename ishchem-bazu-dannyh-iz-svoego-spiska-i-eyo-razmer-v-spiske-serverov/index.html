<!DOCTYPE html><html lang="ru"><head><a href="https://metrika.yandex.ru/stat/?id=12704569&amp;from=informer" target="_blank" rel="nofollow"><img src="https://informer.yandex.ru/informer/12704569/3_0_E9E5E5FF_C9C5C5FF_0_pageviews" style="width:88px; height:31px; border:0;" alt="Яндекс.Метрика" title="Яндекс.Метрика: данные за сегодня (просмотры, визиты и уникальные посетители)" class="ym-advanced-informer" data-cid="12704569" data-lang="ru"></a><script type="text/javascript">(function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
   m[i].l=1*new Date();
   for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
   k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
   (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

   ym(12704569, "init", {
        clickmap:true,
        trackLinks:true,
        accurateTrackBounce:true,
        webvisor:true
   });</script><noscript><div><img src="https://mc.yandex.ru/watch/12704569" style="position:absolute; left:-9999px;" alt=""></div></noscript><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>ищем базу данных из своего списка и её размер в списке серверов - Cyberflat.ru</title><meta name="description" content="```powershell Remove-Variable * -ErrorAction SilentlyContinue # # Этот код ищет базы данных из своего списка и их размер в списке серверов # $x = 1 #read-host '' $serverList = Get-Content 'ServerList.txt' $databaseList = Get-Content 'DatabaseList.txt' $query = 'select count(name) from sysdatabases where name = '{0}''&hellip;"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://cyberflat.ru/ishchem-bazu-dannyh-iz-svoego-spiska-i-eyo-razmer-v-spiske-serverov/"><link rel="alternate" type="application/atom+xml" href="https://cyberflat.ru/feed.xml"><link rel="alternate" type="application/json" href="https://cyberflat.ru/feed.json"><link rel="shortcut icon" href="https://cyberflat.ru/media/website/favicon.ico" type="image/x-icon"><link rel="preload" href="https://cyberflat.ru/assets/dynamic/fonts/publicsans/publicsans.woff2" as="font" type="font/woff2" crossorigin><link rel="preload" href="https://cyberflat.ru/assets/dynamic/fonts/oswald/oswald.woff2" as="font" type="font/woff2" crossorigin><link rel="stylesheet" href="https://cyberflat.ru/assets/css/style.css?v=5d0ee8569079f2d6bff182238909e12e"><link rel="stylesheet" href="https://cyberflat.ru/assets/css/prism.css?v=20dd6e72a01fd3cd26104178888ad8eb"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://cyberflat.ru/ishchem-bazu-dannyh-iz-svoego-spiska-i-eyo-razmer-v-spiske-serverov/"},"headline":"ищем базу данных из своего списка и её размер в списке серверов","datePublished":"2023-04-18T00:09","dateModified":"2023-04-30T18:50","image":{"@type":"ImageObject","url":"https://cyberflat.ru/media/posts/4/kandinsky-download-1682869843008.png","height":767,"width":767},"description":"```powershell Remove-Variable * -ErrorAction SilentlyContinue # # Этот код ищет базы данных из своего списка и их размер в списке серверов # $x = 1 #read-host '' $serverList = Get-Content 'ServerList.txt' $databaseList = Get-Content 'DatabaseList.txt' $query = 'select count(name) from sysdatabases where name = '{0}''&hellip;","author":{"@type":"Person","name":"Korchagin","url":"https://cyberflat.ru/authors/korchagin/"},"publisher":{"@type":"Organization","name":"Korchagin"}}</script><noscript><style>img[loading] {
					opacity: 1;
				}</style></noscript></head><body><header class="topbar" id="js-header"><div class="topbar__inner"><a class="logo" href="https://cyberflat.ru/">Cyberflat.ru</a><nav class="navbar"><button class="navbar__toggle" aria-label="Menu" aria-haspopup="true" aria-expanded="false"><span class="navbar__toggle-box"><span class="navbar__toggle-inner">Menu</span></span></button><ul class="navbar__menu"><li><a href="https://cyberflat.ru/eshche-nemnogo-kotov-iz-ai/" target="_self">others_ai_cats</a></li><li><a href="https://cyberflat.ru/testovaya-pervaya-stranica-na-publii/" target="_self">first</a></li></ul></nav></div></header><div class="content"><div class="infobar"><div class="infobar__update">Last Updated: <time datetime="2023-06-04T21:36">4 июня 2023</time></div><div class="infobar__search"></div></div><main class="main"><article class="post"><figure class="post__featured-image"><img src="https://cyberflat.ru/media/posts/4/kandinsky-download-1682869843008.png" srcset="https://cyberflat.ru/media/posts/4/responsive/kandinsky-download-1682869843008-xs.png 300w, https://cyberflat.ru/media/posts/4/responsive/kandinsky-download-1682869843008-sm.png 480w, https://cyberflat.ru/media/posts/4/responsive/kandinsky-download-1682869843008-md.png 768w, https://cyberflat.ru/media/posts/4/responsive/kandinsky-download-1682869843008-lg.png 1024w, https://cyberflat.ru/media/posts/4/responsive/kandinsky-download-1682869843008-xl.png 1360w, https://cyberflat.ru/media/posts/4/responsive/kandinsky-download-1682869843008-2xl.png 1600w" sizes="(max-width: 1600px) 100vw, 1600px" loading="eager" height="767" width="767" alt=""></figure><header class="u-header post__header"><h1>ищем базу данных из своего списка и её размер в списке серверов</h1><div class="u-header__meta u-small"><div><a href="https://cyberflat.ru/authors/korchagin/" title="Korchagin">Korchagin</a> <time datetime="2023-04-18T00:09">18 апр. 2023 </time><a href="https://cyberflat.ru/tags/powershell/" class="u-tag u-tag--1">powershell</a></div></div></header><div class="post__entry u-inner"><p><code>```powershell</code></p><p><code>Remove-Variable * -ErrorAction SilentlyContinue</code><br><br><code>#</code><br><code># Этот код ищет базы данных из своего списка и их размер в списке серверов</code><br><code>#</code><br><code>$x = 1</code><br><code>#read-host ""</code><br><br><code>$serverList = Get-Content "ServerList.txt"</code><br><code>$databaseList = Get-Content "DatabaseList.txt"</code><br><code>$query = "select count(name) from sysdatabases where name = '{0}'"</code><br><code>$queryexistbase = "SELECT COUNT(*) as [Count] FROM sys.objects"</code><br><code>#$querydbsizeGB = "SELECT SUM(CAST(size / 128.0 /1024 AS DECIMAL(17,2))) AS [Размер в GB] FROM sys.database_files"</code><br><code>$querydbsizeMB = "SELECT SUM(CAST(size / 128.0 AS DECIMAL(17,2))) AS [Размер в MB] FROM sys.database_files"</code><br><code>$outputPath = "Output.log"</code><br><code>$backupDirectory = "C:\backup"</code><br><br><code>foreach ($server in $serverList) {</code><br><code>    foreach ($dbname in $databaseList) {</code><br><code>        $queryDb = $query -f $dbname</code><br><code>        $SQLInstances = $server</code><br><code>        try {</code><br><code>            if ($(Invoke-SQLCmd -ServerInstance $SQLInstances -Database master -Query $queryDb -QueryTimeout 3600 -Verbose -ErrorAction Stop).Column1 -gt 0) {</code><br><code>                $results = Invoke-Sqlcmd -ServerInstance $server -Database $dbname -Query $queryexistbase -ErrorAction SilentlyContinue</code><br><code>                $dbSize = Invoke-Sqlcmd -ServerInstance $server -Database $dbname -Query $querydbsizeMB -ErrorAction SilentlyContinue</code><br><code>                if ($results) {</code><br><code>                    $count = $results.Count</code><br><code>                } else {</code><br><code>                    $count = 0</code><br><code>                }</code><br><br><code>                # Создать резервную копию базы данных</code><br><code>                $backupFile = "{0}\{1}_do_{2}.bak" -f $backupDirectory, $dbname, (Get-Date).AddDays($x).ToString("ddMMyyyy")</code><br><code>                Backup-SqlDatabase -ServerInstance $server -Database $dbname -BackupFile $backupFile</code><br><br><code>                Write-Output "$server,$dbname,$($dbsize.'Размер в MB')"</code><br><code>                #Write-host 'Размер SQL базы в MB' = $dbsize.'Размер в MB' # обрати внимание, здесь значение из массива, а не переменная и текст !!!!</code><br><code>                #Write-host 'Размер SQL базы в GB' = $dbsize.'Размер в GB'</code><br><code>                if ($count) {</code><br><code>                    Add-Content -Path $outputPath -Value "$server,$dbname,$($dbsize.'Размер в MB')"</code><br><code>                    Add-Content -Path $outputPath -Value "$(Get-Date -Format 'dd-MM-yyyy HH:mm'),$server,$dbname,$($dbsize.'Размер в MB')"</code><br><br><code>                } else {</code><br><code>                    Add-Content -Path $outputPath -Value "$server,$($dbsize.'Размер в MB')"</code><br><code>                }</code><br><code>            } else {</code><br><code>                Write-Warning "Database ${dbname} not found on server ${server}"</code><br><code>                Add-Content -Path $outputPath -Value "Database ${dbname} not found on server ${server}"</code><br><code>            }</code><br><code>        } catch {</code><br><code>            Write-Error "Error connecting to database ${dbname} on server ${server}: $_" -ErrorAction Continue</code><br><code>            Add-Content -Path $outputPath -Value "Error connecting to database ${dbname} on server ${server}: $_"</code><br><code>        }</code><br><code>    }</code><br><code>}</code><br><br><code>#Write-Host "Job Done!" -ForegroundColor Green -BackgroundColor Black</code><br><code>Get-Content "example.txt" | ForEach-Object {</code><br><code>    $_.ToCharArray() | ForEach-Object {</code><br><code>        Write-Host -NoNewline $_  -ForegroundColor Green -BackgroundColor Black</code><br><code>        Start-Sleep -Milliseconds 50</code><br><code>    }</code><br><code>}</code></p><p> </p></div><aside class="post__aside"><div class="post__last-updated u-small">This article was updated on 30 апр. 2023</div><div class="post__share"><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fcyberflat.ru%2Fishchem-bazu-dannyh-iz-svoego-spiska-i-eyo-razmer-v-spiske-serverov%2F" class="js-share facebook" title="Share with Facebook" rel="nofollow noopener noreferrer" aria-label="Share with Facebook"><svg class="u-icon"><use xlink:href="https://cyberflat.ru/assets/svg/svg-map.svg#facebook"/></svg> </a><a href="https://pinterest.com/pin/create/button/?url=https%3A%2F%2Fcyberflat.ru%2Fishchem-bazu-dannyh-iz-svoego-spiska-i-eyo-razmer-v-spiske-serverov%2F&amp;media=https%3A%2F%2Fcyberflat.ru%2Fmedia%2Fposts%2F4%2Fkandinsky-download-1682869843008.png&amp;description=%D0%B8%D1%89%D0%B5%D0%BC%20%D0%B1%D0%B0%D0%B7%D1%83%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20%D0%B8%D0%B7%20%D1%81%D0%B2%D0%BE%D0%B5%D0%B3%D0%BE%20%D1%81%D0%BF%D0%B8%D1%81%D0%BA%D0%B0%20%D0%B8%20%D0%B5%D1%91%20%D1%80%D0%B0%D0%B7%D0%BC%D0%B5%D1%80%20%D0%B2%20%D1%81%D0%BF%D0%B8%D1%81%D0%BA%D0%B5%20%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%BE%D0%B2" class="js-share pinterest" title="Share with Pinterest" rel="nofollow noopener noreferrer" aria-label="Share with Pinterest"><svg class="u-icon"><use xlink:href="https://cyberflat.ru/assets/svg/svg-map.svg#pinterest"/></svg> </a><a href="https://wa.me/?text=%D0%B8%D1%89%D0%B5%D0%BC%20%D0%B1%D0%B0%D0%B7%D1%83%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20%D0%B8%D0%B7%20%D1%81%D0%B2%D0%BE%D0%B5%D0%B3%D0%BE%20%D1%81%D0%BF%D0%B8%D1%81%D0%BA%D0%B0%20%D0%B8%20%D0%B5%D1%91%20%D1%80%D0%B0%D0%B7%D0%BC%D0%B5%D1%80%20%D0%B2%20%D1%81%D0%BF%D0%B8%D1%81%D0%BA%D0%B5%20%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%BE%D0%B2 https%3A%2F%2Fcyberflat.ru%2Fishchem-bazu-dannyh-iz-svoego-spiska-i-eyo-razmer-v-spiske-serverov%2F" class="js-share whatsapp" rel="nofollow noopener noreferrer" title="Share with WhatsApp" aria-label="Share with WhatsApp"><svg class="u-icon"><use xlink:href="https://cyberflat.ru/assets/svg/svg-map.svg#whatsapp"/></svg> </a><a href="https://t.me/share/url?url=https%3A%2F%2Fcyberflat.ru%2Fishchem-bazu-dannyh-iz-svoego-spiska-i-eyo-razmer-v-spiske-serverov%2F&amp;text=%D0%B8%D1%89%D0%B5%D0%BC%20%D0%B1%D0%B0%D0%B7%D1%83%20%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85%20%D0%B8%D0%B7%20%D1%81%D0%B2%D0%BE%D0%B5%D0%B3%D0%BE%20%D1%81%D0%BF%D0%B8%D1%81%D0%BA%D0%B0%20%D0%B8%20%D0%B5%D1%91%20%D1%80%D0%B0%D0%B7%D0%BC%D0%B5%D1%80%20%D0%B2%20%D1%81%D0%BF%D0%B8%D1%81%D0%BA%D0%B5%20%D1%81%D0%B5%D1%80%D0%B2%D0%B5%D1%80%D0%BE%D0%B2" class="js-share telegram" target="_blank" rel="nofollow noopener noreferrer" aria-label="Share with Telegram"><svg class="u-icon"><use xlink:href="https://cyberflat.ru/assets/svg/svg-map.svg#telegram"/></svg></a></div></aside><footer class="post__footer"><ul class="post__tag box"><li><a href="https://cyberflat.ru/tags/powershell/" class="u-tag u-tag--1" title="powershell">powershell</a></li></ul><nav class="post__nav box"><div class="post__nav__prev"><a href="https://cyberflat.ru/pod-znamenem-nebes/" class="post__nav__link" rel="prev"><img src="https://cyberflat.ru/media/posts/3/responsive/le0afd642f1cffb78b84o-2-xs.png" loading="lazy" alt="" height="1350" width="1080"><div class="u-small">Previous Post<h5>Под знаменем небес</h5></div></a></div><div class="post__nav__next"><a href="https://cyberflat.ru/maxdop/" class="post__nav__link" rel="next"><div class="u-small">Next Post<h5>MAXDOP</h5></div></a></div></nav></footer></article><div class="comments-area box"><div class="comments"><div class="comments-wrapper"><h2>Comments</h2><div id="disqus_thread"></div><noscript>Please enable JS to use the comments form.</noscript><script type="text/javascript">var disqus_config = function () {
							this.page.url = 'https://cyberflat.ru/ishchem-bazu-dannyh-iz-svoego-spiska-i-eyo-razmer-v-spiske-serverov/';
							this.page.identifier = '4'; 
							this.language = 'ru_RU';
						};
						
						
				var disqus_element_to_check = document.getElementById('disqus_thread');

				if ('IntersectionObserver' in window) {
					var iObserver = new IntersectionObserver(
						(entries, observer) => {
							entries.forEach(entry => {
								if (entry.intersectionRatio >= 0.1) {
									(function () {
										var d = document, s = d.createElement('script');
										s.src = 'https://'+('cyberflat-ru').trim()+'.disqus.com/embed.js';
										s.setAttribute('data-timestamp', +new Date());
										(d.head || d.body).appendChild(s);
									})();
									observer.unobserve(entry.target);
								}
							});
						},
						{
							threshold: [0, 0.2, 0.5, 1]
						}
					);

					iObserver.observe(disqus_element_to_check);
				} else {
					(function () {
						var d = document, s = d.createElement('script');
						s.src = 'https://'+('cyberflat-ru').trim()+'.disqus.com/embed.js';
						s.setAttribute('data-timestamp', +new Date());
						(d.head || d.body).appendChild(s);
					})();
				}</script><script type="text/javascript"></script></div></div></div></main><div class="sidebar"><section class="box"><h3 class="box__title">Follow us</h3><div class="follow"><a href="www.instagram.com/zyberex/" class="instagram" aria-label="Instagram"><svg class="u-icon"><use xlink:href="https://cyberflat.ru/assets/svg/svg-map.svg#instagram"/></svg> Instagram </a><a href="https://www.youtube.com/@cyberflat_ru6118/videos" class="youtube" aria-label="Youtube"><svg class="u-icon"><use xlink:href="https://cyberflat.ru/assets/svg/svg-map.svg#youtube"/></svg> Youtube </a><a href="https://telegram.me/share/url?url&#x3D;t.me/cyberflat" class="telegram" aria-label="Telegram"><svg class="u-icon"><use xlink:href="https://cyberflat.ru/assets/svg/svg-map.svg#telegram"/></svg> Telegram</a></div></section><section class="box"><h3 class="box__title">Tags</h3><ul class="tags"><li><a href="https://cyberflat.ru/tags/agrofitness/">agrofitness</a> <span class="u-small">(4)</span></li><li><a href="https://cyberflat.ru/tags/cats/">cats</a> <span class="u-small">(4)</span></li><li><a href="https://cyberflat.ru/tags/chatgpt/">chatgpt</a> <span class="u-small">(2)</span></li><li><a href="https://cyberflat.ru/tags/cyberpunk/">cyberpunk</a> <span class="u-small">(3)</span></li><li><a href="https://cyberflat.ru/tags/dhcp/">dhcp</a> <span class="u-small">(1)</span></li></ul></section></div><footer class="footer"><a class="footer__logo" href="https://cyberflat.ru/">Cyberflat.ru</a><nav><ul class="footer__nav"></ul></nav><div class="footer__follow"><a href="www.instagram.com/zyberex/" aria-label="Instagram"><svg><use xlink:href="https://cyberflat.ru/assets/svg/svg-map.svg#instagram"/></svg> </a><a href="https://www.youtube.com/@cyberflat_ru6118/videos" aria-label="Youtube"><svg><use xlink:href="https://cyberflat.ru/assets/svg/svg-map.svg#youtube"/></svg></a></div><div class="footer__copyright"><p>Powered by cyberflat.ru</p></div></footer></div><script defer="defer" src="https://cyberflat.ru/assets/js/prism.js?v=73c36e5c6bde9048f51586dda5708dd9"></script><script>window.publiiThemeMenuConfig = {    
        mobileMenuMode: 'sidebar',
        animationSpeed: 300,
        submenuWidth: 'auto',
        doubleClickTime: 500,
        mobileMenuExpandableSubmenus: true, 
        relatedContainerForOverlayMenuSelector: '.navbar',
   };</script><script defer="defer" src="https://cyberflat.ru/assets/js/scripts.min.js?v=ef33954c8f912e6c18ee116825aadc90"></script><script>var images = document.querySelectorAll('img[loading]');

      for (var i = 0; i < images.length; i++) {
         if (images[i].complete) {
               images[i].classList.add('is-loaded');
         } else {
               images[i].addEventListener('load', function () {
                  this.classList.add('is-loaded');
               }, false);
         }
      }</script></body></html>